@using HD.Station.MediaManagement.Abstractions.Data
@model HD.Station.MediaManagement.Mvc.Features.MediaFile.Models.MediaFileViewModel

@{
    ViewData["Title"] = "Chi tiết Media File";
}

<div class="container py-4">
    <h2>@ViewData["Title"]</h2>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">@Model.FileName</h5>
            <div class="btn-group">
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-sm btn-primary">Sửa</a>
                <a asp-action="Index" class="btn btn-sm btn-secondary">Danh sách</a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">ID</dt>
                        <dd class="col-sm-7">@Model.Id</dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.MediaType)</dt>
                        <dd class="col-sm-7">@Model.MediaType</dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.Format)</dt>
                        <dd class="col-sm-7">@Model.Format</dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.Size)</dt>
                        <dd class="col-sm-7">@($"{Model.Size / 1024} KB ({Model.Size} bytes)")</dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.Status)</dt>
                        <dd class="col-sm-7">
                            <span class="badge @(Model.Status == StatusEnum.Active ? "bg-success" : "bg-secondary")">
                                @Model.Status
                            </span>
                        </dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.UploadTime)</dt>
                        <dd class="col-sm-7">@Model.UploadTime.ToString("dd/MM/yyyy HH:mm:ss")</dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.StoragePath)</dt>
                        <dd class="col-sm-7">
                            <small class="text-muted">@Model.StoragePath</small>
                        </dd>

                        <dt class="col-sm-5">Hash</dt>
                        <dd class="col-sm-7">
                            <small class="text-muted">@Model.Hash</small>
                        </dd>

                        <dt class="col-sm-5">@Html.DisplayNameFor(m => m.Description)</dt>
                        <dd class="col-sm-7">@(!string.IsNullOrWhiteSpace(Model.Description) ? Model.Description : "<em>Không có mô tả</em>")</dd>
                    </dl>
                </div>
            </div>

            @* Preview Image/Video *@
            @if (!string.IsNullOrEmpty(Model.StoragePath)
            && (Model.MediaType == MediaTypeEnum.Image || Model.MediaType == MediaTypeEnum.Video))
            {
                <div class="mt-4">
                    <h6>Xem trước:</h6>
                    @if (Model.MediaType == MediaTypeEnum.Image)
                    {
                        <img src="@Model.StoragePath" class="img-fluid rounded" style="max-height:400px;" alt="@Model.FileName" />
                    }
                    else
                    {
                        <video controls class="w-100 rounded" style="max-height:400px;">
                            <source src="@Model.StoragePath" />
                            Trình duyệt không hỗ trợ thẻ video.
                        </video>
                    }
                </div>
            }

            @* MediaInfo JSON *@
            @if (!string.IsNullOrWhiteSpace(Model.MediaInfoJson))
            {
                <div class="mt-4">
                    <h6>Thông tin Media (MediaInfo):</h6>
                    <pre class="bg-light p-3 rounded" style="max-height:300px; overflow-y:auto;">
                        @Model.MediaInfoJson
                        </pre>
                </div>
            }
        </div>
        <div class="card-footer text-end">
            <button type="button"
                    class="btn btn-sm btn-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal">
                Xóa
            </button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="deleteModalLabel" class="modal-title">Xác nhận xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    Bạn có chắc chắn muốn xóa file "<strong>@Model.FileName</strong>"?
                </div>
                <div class="modal-footer">
                    <form asp-action="Delete" asp-route-id="@Model.Id" method="post">
                        @Html.AntiForgeryToken()
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
